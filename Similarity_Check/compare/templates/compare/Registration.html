{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register Book - Similarity Checker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-gradient-to-r from-blue-400 to-purple-500 min-h-screen flex items-center justify-center p-6">

<div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl p-8">
  <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">
    <span class="me-2">üìö</span>Register a New Book
  </h1>

  <form id="registrationForm" method="POST" enctype="multipart/form-data" class="space-y-5">
    {% csrf_token %}

    <!-- Book Title -->
    <div class="flex flex-wrap items-center gap-3">
      <label for="book_title" class="w-full md:w-1/4 font-medium text-gray-700">Book Title:</label>
      <div class="w-full md:w-5/4">
        {{ form.book_title|add_class:"form-control py-2 text-base border-gray-300 rounded-md shadow-sm" }}
      </div>
    </div>

    <!-- Authors -->
    <div class="flex flex-wrap items-center gap-3">
      <label for="authors" class="w-full md:w-1/4 font-medium text-gray-700">Authors:</label>
      <div class="w-full md:w-5/4">
        {{ form.authors|add_class:"form-control py-2 text-base border-gray-300 rounded-md shadow-sm" }}
      </div>
    </div>

    <!-- Area -->
    <div class="flex flex-wrap items-center gap-3">
      <label for="area" class="w-full md:w-1/4 font-medium text-gray-700">Area:</label>
      <div class="w-full md:w-5/4">
        {{ form.area|add_class:"form-control py-2 text-base border-gray-300 rounded-md shadow-sm" }}
      </div>
    </div>

    <!-- Year (Dropdown) -->
    <div class="flex flex-wrap items-center gap-3">
      <label for="year" class="w-full md:w-1/4 font-medium text-gray-700">Year:</label>
      <div class="w-full md:w-5/4">
        <select id="year" name="year" required
          class="form-select w-full py-2 text-base border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
          <option value="">-- Select Year --</option>
        </select>
      </div>
    </div>

    <!-- File -->
    <div class="flex flex-wrap items-center gap-3">
      <label for="file" class="w-full md:w-1/4 font-medium text-gray-700">Book File (PDF or Word):</label>
      <div class="w-full md:w-5/4">
        {{ form.file|add_class:"form-control py-2 text-base border-gray-300 rounded-md shadow-sm" }}
        <p id="fileError" class="text-red-600 text-sm mt-2 hidden">Invalid file type. Only PDF, DOC, or DOCX files are allowed.</p>
      </div>
    </div>

    <!-- Submit -->
    <div>
      <button type="submit"
        class="w-full py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-md shadow-sm transition duration-200">
        Submit
      </button>
    </div>
  </form>

  <!-- Back Button -->
  <a href="{% url 'dashboard' %}"
    class="mt-5 block text-center w-full py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md shadow-sm transition duration-200">
    ‚Üê Back to Dashboard
  </a>
</div>

<!-- JS: Populate Year Dropdown (Descending) & File Validation -->
<script>
  const yearSelect = document.getElementById("year");
  const selectedYear = "{{ form.year.value|default:'' }}";

  for (let i = 2025; i >= 1; i--) {
    const option = document.createElement("option");
    option.value = i;
    option.textContent = i;
    if (selectedYear && i.toString() === selectedYear) {
      option.selected = true;
    }
    yearSelect.appendChild(option);
  }

  document.getElementById('registrationForm').addEventListener('submit', function (event) {
    const fileInput = document.querySelector('input[type="file"]');
    const filePath = fileInput.value;
    const allowedExtensions = /\.(pdf|doc|docx)$/i;

    if (!allowedExtensions.exec(filePath)) {
      event.preventDefault();
      document.getElementById('fileError').classList.remove('hidden');
    } else {
      document.getElementById('fileError').classList.add('hidden');
    }
  });
</script>

</body>
</html>
